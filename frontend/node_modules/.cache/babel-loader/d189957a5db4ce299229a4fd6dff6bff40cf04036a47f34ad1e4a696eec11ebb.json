{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\HP\\\\Downloads\\\\xeno_project_v2\\\\frontend\\\\src\\\\pages\\\\SalesTrendPage.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { useOutletContext } from 'react-router-dom';\nimport SalesTrendChart from '../components/SalesTrendChart';\nimport API from '../api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function SalesTrendPage() {\n  _s();\n  const {\n    salesTrend: initialSalesTrend,\n    dataSource,\n    tenantId\n  } = useOutletContext(); // added tenantId\n  const [salesTrend, setSalesTrend] = useState(initialSalesTrend || []);\n  const [loading, setLoading] = useState(false);\n  useEffect(() => {\n    const fetchShopifySalesTrend = async () => {\n      if (dataSource !== 'shopify') {\n        setSalesTrend(initialSalesTrend || []);\n        return;\n      }\n      try {\n        setLoading(true);\n\n        // --- Pass tenantId in headers for multi-tenancy ---\n        const headers = tenantId ? {\n          'x-tenant-id': tenantId\n        } : {};\n        const ordersRes = await API.get('/shopify/sync/orders', {\n          headers\n        });\n        const orders = ordersRes.data.data || [];\n\n        // Generate last 30 days\n        const today = new Date();\n        const last30Days = Array.from({\n          length: 30\n        }, (_, i) => {\n          const date = new Date(today);\n          date.setDate(today.getDate() - i);\n          return date.toISOString().slice(0, 10);\n        }).reverse();\n\n        // Aggregate daily revenue\n        const trendData = last30Days.map(date => {\n          const dailyTotal = orders.filter(order => {\n            var _order$created_at;\n            return (_order$created_at = order.created_at) === null || _order$created_at === void 0 ? void 0 : _order$created_at.startsWith(date);\n          }).reduce((sum, order) => sum + parseFloat(order.total_price || 0), 0);\n          return {\n            date,\n            revenue: dailyTotal\n          };\n        });\n        setSalesTrend(trendData);\n      } catch (err) {\n        console.error('Failed to fetch Shopify sales trend:', err);\n        setSalesTrend([]);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchShopifySalesTrend();\n  }, [dataSource, initialSalesTrend, tenantId]); // added tenantId\n\n  if (loading) return /*#__PURE__*/_jsxDEV(\"h3\", {\n    children: \"Loading Sales Trend...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 54,\n    columnNumber: 23\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"widget\",\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: \"Sales Trend (Last 30 Days)\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(SalesTrendChart, {\n      data: salesTrend\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 57,\n    columnNumber: 5\n  }, this);\n}\n_s(SalesTrendPage, \"VfzeyydeEjqRAx+YjczlttQYZ54=\", false, function () {\n  return [useOutletContext];\n});\n_c = SalesTrendPage;\nvar _c;\n$RefreshReg$(_c, \"SalesTrendPage\");","map":{"version":3,"names":["React","useEffect","useState","useOutletContext","SalesTrendChart","API","jsxDEV","_jsxDEV","SalesTrendPage","_s","salesTrend","initialSalesTrend","dataSource","tenantId","setSalesTrend","loading","setLoading","fetchShopifySalesTrend","headers","ordersRes","get","orders","data","today","Date","last30Days","Array","from","length","_","i","date","setDate","getDate","toISOString","slice","reverse","trendData","map","dailyTotal","filter","order","_order$created_at","created_at","startsWith","reduce","sum","parseFloat","total_price","revenue","err","console","error","children","fileName","_jsxFileName","lineNumber","columnNumber","className","_c","$RefreshReg$"],"sources":["C:/Users/HP/Downloads/xeno_project_v2/frontend/src/pages/SalesTrendPage.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useOutletContext } from 'react-router-dom';\r\nimport SalesTrendChart from '../components/SalesTrendChart';\r\nimport API from '../api';\r\n\r\nexport default function SalesTrendPage() {\r\n  const { salesTrend: initialSalesTrend, dataSource, tenantId } = useOutletContext(); // added tenantId\r\n  const [salesTrend, setSalesTrend] = useState(initialSalesTrend || []);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const fetchShopifySalesTrend = async () => {\r\n      if (dataSource !== 'shopify') {\r\n        setSalesTrend(initialSalesTrend || []);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        setLoading(true);\r\n\r\n        // --- Pass tenantId in headers for multi-tenancy ---\r\n        const headers = tenantId ? { 'x-tenant-id': tenantId } : {};\r\n        const ordersRes = await API.get('/shopify/sync/orders', { headers });\r\n        const orders = ordersRes.data.data || [];\r\n\r\n        // Generate last 30 days\r\n        const today = new Date();\r\n        const last30Days = Array.from({ length: 30 }, (_, i) => {\r\n          const date = new Date(today);\r\n          date.setDate(today.getDate() - i);\r\n          return date.toISOString().slice(0, 10);\r\n        }).reverse();\r\n\r\n        // Aggregate daily revenue\r\n        const trendData = last30Days.map(date => {\r\n          const dailyTotal = orders\r\n            .filter(order => order.created_at?.startsWith(date))\r\n            .reduce((sum, order) => sum + parseFloat(order.total_price || 0), 0);\r\n          return { date, revenue: dailyTotal };\r\n        });\r\n\r\n        setSalesTrend(trendData);\r\n      } catch (err) {\r\n        console.error('Failed to fetch Shopify sales trend:', err);\r\n        setSalesTrend([]);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchShopifySalesTrend();\r\n  }, [dataSource, initialSalesTrend, tenantId]); // added tenantId\r\n\r\n  if (loading) return <h3>Loading Sales Trend...</h3>;\r\n\r\n  return (\r\n    <div className=\"widget\">\r\n      <h3>Sales Trend (Last 30 Days)</h3>\r\n      <SalesTrendChart data={salesTrend} />\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}